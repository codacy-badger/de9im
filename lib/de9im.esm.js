import n from"@turf/turf";var t=r,e=r;function r(n,t,e){e=e||2;var r,a,l,u,c,p,g,x=t&&t.length,d=x?t[0]*e:n.length,v=i(n,0,d,e,!0),m=[];if(!v||v.next===v.prev)return m;if(x&&(v=function(n,t,e,r){var s,a,l,u,c,p=[];for(s=0,a=t.length;s<a;s++)l=t[s]*r,u=s<a-1?t[s+1]*r:n.length,(c=i(n,l,u,r,!1))===c.next&&(c.steiner=!0),p.push(y(c));for(p.sort(h),s=0;s<p.length;s++)f(p[s],e),e=o(e,e.next);return e}(n,t,v,e)),n.length>80*e){r=l=n[0],a=u=n[1];for(var P=e;P<d;P+=e)(c=n[P])<r&&(r=c),(p=n[P+1])<a&&(a=p),c>l&&(l=c),p>u&&(u=p);g=0!==(g=Math.max(l-r,u-a))?1/g:0}return s(v,m,e,r,a,g),m}function i(n,t,e,r,i){var o,s;if(i===M(n,t,e,r)>0)for(o=t;o<e;o+=r)s=b(o,n[o],n[o+1],s);else for(o=e-r;o>=t;o-=r)s=b(o,n[o],n[o+1],s);return s&&v(s,s.next)&&(L(s),s=s.next),s}function o(n,t){if(!n)return n;t||(t=n);var e,r=n;do{if(e=!1,r.steiner||!v(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else{if(L(r),(r=t=r.prev)===r.next)break;e=!0}}while(e||r!==t);return t}function s(n,t,e,r,i,h,f){if(n){!f&&h&&function(n,t,e,r){var i=n;do{null===i.z&&(i.z=p(i.x,i.y,t,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,function(n){var t,e,r,i,o,s,a,l,u=1;do{for(e=n,n=null,o=null,s=0;e;){for(s++,r=e,a=0,t=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:n=i,i.prevZ=o,o=i;e=r}o.nextZ=null,u*=2}while(s>1)}(i)}(n,r,i,h);for(var y,g,x=n;n.prev!==n.next;)if(y=n.prev,g=n.next,h?l(n,r,i,h):a(n))t.push(y.i/e),t.push(n.i/e),t.push(g.i/e),L(n),n=g.next,x=g.next;else if((n=g)===x){f?1===f?s(n=u(n,t,e),t,e,r,i,h,2):2===f&&c(n,t,e,r,i,h):s(o(n),t,e,r,i,h,1);break}}}function a(n){var t=n.prev,e=n,r=n.next;if(d(t,e,r)>=0)return!1;for(var i=n.next.next;i!==n.prev;){if(g(t.x,t.y,e.x,e.y,r.x,r.y,i.x,i.y)&&d(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(n,t,e,r){var i=n.prev,o=n,s=n.next;if(d(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=p(a,l,t,e,r),f=p(u,c,t,e,r),y=n.prevZ,x=n.nextZ;y&&y.z>=h&&x&&x.z<=f;){if(y!==n.prev&&y!==n.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,y.x,y.y)&&d(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x!==n.prev&&x!==n.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,x.x,x.y)&&d(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=h;){if(y!==n.prev&&y!==n.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,y.x,y.y)&&d(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=f;){if(x!==n.prev&&x!==n.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,x.x,x.y)&&d(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function u(n,t,e){var r=n;do{var i=r.prev,o=r.next.next;!v(i,o)&&m(i,r,r.next,o)&&P(i,o)&&P(o,i)&&(t.push(i.i/e),t.push(r.i/e),t.push(o.i/e),L(r),L(r.next),r=n=o),r=r.next}while(r!==n);return r}function c(n,t,e,r,i,a){var l=n;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&x(l,u)){var c=S(l,u);return l=o(l,l.next),c=o(c,c.next),s(l,t,e,r,i,a),void s(c,t,e,r,i,a)}u=u.next}l=l.next}while(l!==n)}function h(n,t){return n.x-t.x}function f(n,t){if(t=function(n,t){var e,r=t,i=n.x,o=n.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}e=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!e)return null;if(i===s)return e.prev;var l,u=e,c=e.x,h=e.y,f=1/0;r=e.next;for(;r!==u;)i>=r.x&&r.x>=c&&i!==r.x&&g(o<h?i:s,o,c,h,o<h?s:i,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(i-r.x))<f||l===f&&r.x>e.x)&&P(r,n)&&(e=r,f=l),r=r.next;return e}(n,t)){var e=S(t,n);o(e,e.next)}}function p(n,t,e,r,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-e)*i)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(n){var t=n,e=n;do{(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next}while(t!==n);return e}function g(n,t,e,r,i,o,s,a){return(i-s)*(t-a)-(n-s)*(o-a)>=0&&(n-s)*(r-a)-(e-s)*(t-a)>=0&&(e-s)*(o-a)-(i-s)*(r-a)>=0}function x(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(n,t){var e=n;do{if(e.i!==n.i&&e.next.i!==n.i&&e.i!==t.i&&e.next.i!==t.i&&m(e,e.next,n,t))return!0;e=e.next}while(e!==n);return!1}(n,t)&&P(n,t)&&P(t,n)&&function(n,t){var e=n,r=!1,i=(n.x+t.x)/2,o=(n.y+t.y)/2;do{e.y>o!=e.next.y>o&&e.next.y!==e.y&&i<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==n);return r}(n,t)}function d(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function v(n,t){return n.x===t.x&&n.y===t.y}function m(n,t,e,r){return!!(v(n,t)&&v(e,r)||v(n,r)&&v(e,t))||d(n,t,e)>0!=d(n,t,r)>0&&d(e,r,n)>0!=d(e,r,t)>0}function P(n,t){return d(n.prev,n,n.next)<0?d(n,t,n.next)>=0&&d(n,n.prev,t)>=0:d(n,t,n.prev)<0||d(n,n.next,t)<0}function S(n,t){var e=new w(n.i,n.x,n.y),r=new w(t.i,t.x,t.y),i=n.next,o=t.prev;return n.next=t,t.prev=n,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function b(n,t,e,r){var i=new w(n,t,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function L(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function w(n,t,e){this.i=n,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(n,t,e,r){for(var i=0,o=t,s=e-r;o<e;o+=r)i+=(n[s]-n[o])*(n[o+1]+n[s+1]),s=o;return i}r.deviation=function(n,t,e,r){var i=t&&t.length,o=i?t[0]*e:n.length,s=Math.abs(M(n,0,o,e));if(i)for(var a=0,l=t.length;a<l;a++){var u=t[a]*e,c=a<l-1?t[a+1]*e:n.length;s-=Math.abs(M(n,u,c,e))}var h=0;for(a=0;a<r.length;a+=3){var f=r[a]*e,p=r[a+1]*e,y=r[a+2]*e;h+=Math.abs((n[f]-n[y])*(n[p+1]-n[f+1])-(n[f]-n[p])*(n[y+1]-n[f+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(n){for(var t=n[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,i=0;i<n.length;i++){for(var o=0;o<n[i].length;o++)for(var s=0;s<t;s++)e.vertices.push(n[i][o][s]);i>0&&(r+=n[i-1].length,e.holes.push(r))}return e},t.default=e;var I=e=>{const r=[];return n.flattenEach(e,e=>{const i=(e=>{const r=t.flatten(e.geometry.coordinates),i=t(r.vertices,r.holes,r.dimensions),o=[],s=i.length/3;for(let t=0;t<s;++t){const e=[];for(let n=0;n<3;++n){const o=[];for(let e=0;e<r.dimensions;++e){const s=r.dimensions*i[3*t+n]+e;o.push(r.vertices[s])}e.push(o)}e.push(e[0]),o.push(n.polygon([e]))}return n.featureCollection(o)})(e);n.featureEach(i,n=>{r.push(n)})}),n.featureCollection(r)};const E=(t,e)=>{const r=[];let i=j(t,e);i&&Array.prototype.push.apply(r,i);let o=B(t,e);return o&&Array.prototype.push.apply(r,o),0==r.length&&r.push(t),n.featureCollection(r)},B=(t,e)=>{const r=[];try{const i=n.difference(t,e);if(null===i)return null;i&&i.geometry.type.includes("Polygon")&&n.flattenEach(i,t=>{n.featureEach(I(t),n=>{r.push(n)})})}catch(n){return null}return r},j=(t,e)=>{const r=[];try{const i=n.intersect(t,e);if(null===i)return null;i&&i.geometry.type.includes("Polygon")&&n.flattenEach(i,t=>{n.featureEach(I(t),n=>{r.push(n)})})}catch(n){return null}return r};var X={segment:(t,e)=>{const r=t.geometry.coordinates.concat(),i=n.lineIntersect(t,e);return n.coordEach(i,n=>{r.push(n)}),n.coordEach(e,e=>{n.booleanPointOnLine(e,t,{ignoreEndVertices:!0})&&r.push(e)}),r.length>=2&&r.sort((e,r)=>{const i=t.geometry.coordinates[0];return n.distance(e,i)-n.distance(r,i)}),n.lineString(r)},triangle:(t,e)=>{let r=[t];return n.featureEach(e,(t,e)=>{const i=[];for(let e=0;e<r.length;e++){const o=E(r[e],t);n.featureEach(o,n=>{i.push(n)})}r=i}),n.featureCollection(r)}};var Y={centroids:t=>{const e=[];return n.segmentEach(t,t=>{e.push(n.centroid(t))}),n.featureCollection(e)},disjoint:(t,e)=>{const r=t.bbox?t.bbox:n.bbox(t),i=e.bbox?e.bbox:n.bbox(e);return r[0]>i[2]||r[2]<i[0]||r[1]>i[3]||r[3]<i[1]},similar:(n,t,e=0,r=0,i=-1,o=!1)=>{if(n.length!==t.length)return!1;const s=n.length-1;i<0&&(i=s),i=Math.min(s,Math.max(i,0));for(let a=0;a<i;a+=1){const i=(r+(o?-a:a)+s)%s;if(!1===n[(e+a+s)%s].every((n,e)=>n===t[i][e]))return!1}return!0}};var $={type:t=>{const e=n.getType(t);return!1===["Collection","Multi"].some(n=>e.includes(n))?e:n.flattenReduce(t,(t,e,r)=>{if("Mixed"===t)return t;const i=n.getType(e);return"Unknown"!==t&&t!==i?"Mixed":i},"Unknown")}};const _=(n,t,e)=>e(n,(n,e)=>n&&t(e),!0),Z=(n,t,e)=>e(n,(n,e)=>n||t(e),!1);var O={coordEvery:(t,e)=>_(t,e,n.coordReduce),coordSome:(t,e)=>Z(t,e,n.coordReduce),featureEvery:(t,e)=>_(t,e,n.featureReduce),featureSome:(t,e)=>Z(t,e,n.featureReduce),flattenEvery:(t,e)=>_(t,e,n.flattenReduce),flattenSome:(t,e)=>Z(t,e,n.flattenReduce),segmentEvery:(t,e)=>_(t,e,n.segmentReduce),segmentSome:(t,e)=>Z(t,e,n.segmentReduce)};function C(n,t,e,r,i){!function n(t,e,r,i,o){for(;i>r;){if(i-r>600){var s=i-r+1,a=e-r+1,l=Math.log(s),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(s-u)/s)*(a-s/2<0?-1:1),h=Math.max(r,Math.floor(e-a*u/s+c)),f=Math.min(i,Math.floor(e+(s-a)*u/s+c));n(t,e,h,f,o)}var p=t[e],y=r,g=i;for(R(t,r,e),o(t[i],p)>0&&R(t,r,i);y<g;){for(R(t,y,g),y++,g--;o(t[y],p)<0;)y++;for(;o(t[g],p)>0;)g--}0===o(t[r],p)?R(t,r,g):R(t,++g,i),g<=e&&(r=g+1),e<=g&&(i=g-1)}}(n,t,e||0,r||n.length-1,i||A)}function R(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}function A(n,t){return n<t?-1:n>t?1:0}function F(n,t){if(!(this instanceof F))return new F(n,t);this._maxEntries=Math.max(4,n||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function k(n,t,e){if(!e)return t.indexOf(n);for(var r=0;r<t.length;r++)if(e(n,t[r]))return r;return-1}function T(n,t){z(n,0,n.children.length,t,n)}function z(n,t,e,r,i){i||(i=H(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=t;s<e;s++)o=n.children[s],D(i,n.leaf?r(o):o);return i}function D(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function J(n,t){return n.minX-t.minX}function N(n,t){return n.minY-t.minY}function q(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function G(n){return n.maxX-n.minX+(n.maxY-n.minY)}function U(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function V(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function H(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function K(n,t,e,r,i){for(var o,s=[t,e];s.length;)(e=s.pop())-(t=s.pop())<=r||(C(n,o=t+Math.ceil((e-t)/r/2)*r,t,e,i),s.push(t,o,o,e))}function Q(n){var t=F(n);return t.insert=function(n){if(Array.isArray(n)){var t=n;(n=W(t)).bbox=t}else n.bbox=n.bbox?n.bbox:nn(n);return F.prototype.insert.call(this,n)},t.load=function(n){var t=[];return Array.isArray(n)?n.forEach(function(n){var e=W(n);e.bbox=n,t.push(e)}):function(n,t){if("Feature"===n.type)t(n,0);else if("FeatureCollection"===n.type)for(var e=0;e<n.features.length;e++)t(n.features[e],e)}(n,function(n){n.bbox=n.bbox?n.bbox:nn(n),t.push(n)}),F.prototype.load.call(this,t)},t.remove=function(n){if(Array.isArray(n)){var t=n;(n=W(t)).bbox=t}return F.prototype.remove.call(this,n)},t.clear=function(){return F.prototype.clear.call(this)},t.search=function(n){return{type:"FeatureCollection",features:F.prototype.search.call(this,this.toBBox(n))}},t.collides=function(n){return F.prototype.collides.call(this,this.toBBox(n))},t.all=function(){return{type:"FeatureCollection",features:F.prototype.all.call(this)}},t.toJSON=function(){return F.prototype.toJSON.call(this)},t.fromJSON=function(n){return F.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var t;return{minX:(t=n.bbox?n.bbox:Array.isArray(n)&&4===n.length?n:nn(n))[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}function W(n){var t=[n[0],n[1]],e=[n[0],n[3]],r=[n[2],n[3]];return{type:"Feature",bbox:n,properties:{},geometry:{type:"Polygon",coordinates:[[t,[n[2],n[1]],r,e,t]]}}}function nn(n){var t=[1/0,1/0,-1/0,-1/0];return function n(t,e,r){if(null!==t)for(var i,o,s,a,l,u,c,h,f=0,p=0,y=t.type,g="FeatureCollection"===y,x="Feature"===y,d=g?t.features.length:1,v=0;v<d;v++){l=(h=!!(c=g?t.features[v].geometry:x?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var m=0;m<l;m++){var P=0,S=0;if(null!==(a=h?c.geometries[m]:c)){u=a.coordinates;var b=a.type;switch(f=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":e(u,p,v,P,S),p++,P++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++)e(u[i],p,v,P,S),p++,"MultiPoint"===b&&P++;"LineString"===b&&P++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(o=0;o<u[i].length-f;o++)e(u[i][o],p,v,P,S),p++;"MultiLineString"===b&&P++,"Polygon"===b&&S++}"Polygon"===b&&P++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for("MultiPolygon"===b&&(S=0),o=0;o<u[i].length;o++){for(s=0;s<u[i][o].length-f;s++)e(u[i][o][s],p,v,P,S),p++;S++}P++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)n(a.geometries[i],e,r);break;default:throw new Error("Unknown Geometry Type")}}}}}(n,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}F.prototype={all:function(){return this._all(this.data,[])},search:function(n){var t=this.data,e=[],r=this.toBBox;if(!V(n,t))return e;for(var i,o,s,a,l=[];t;){for(i=0,o=t.children.length;i<o;i++)s=t.children[i],V(n,a=t.leaf?r(s):s)&&(t.leaf?e.push(s):U(n,a)?this._all(s,e):l.push(s));t=l.pop()}return e},collides:function(n){var t=this.data,e=this.toBBox;if(!V(n,t))return!1;for(var r,i,o,s,a=[];t;){for(r=0,i=t.children.length;r<i;r++)if(o=t.children[r],V(n,s=t.leaf?e(o):o)){if(t.leaf||U(n,s))return!0;a.push(o)}t=a.pop()}return!1},load:function(n){if(!n||!n.length)return this;if(n.length<this._minEntries){for(var t=0,e=n.length;t<e;t++)this.insert(n[t]);return this}var r=this._build(n.slice(),0,n.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(n){return n&&this._insert(n,this.data.height-1),this},clear:function(){return this.data=H([]),this},remove:function(n,t){if(!n)return this;for(var e,r,i,o,s=this.data,a=this.toBBox(n),l=[],u=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],e=u.pop(),o=!0),s.leaf&&-1!==(i=k(n,s.children,t)))return s.children.splice(i,1),l.push(s),this._condense(l),this;o||s.leaf||!U(s,a)?r?(e++,s=r.children[e],o=!1):s=null:(l.push(s),u.push(e),e=0,r=s,s=s.children[0])}return this},toBBox:function(n){return n},compareMinX:J,compareMinY:N,toJSON:function(){return this.data},fromJSON:function(n){return this.data=n,this},_all:function(n,t){for(var e=[];n;)n.leaf?t.push.apply(t,n.children):e.push.apply(e,n.children),n=e.pop();return t},_build:function(n,t,e,r){var i,o=e-t+1,s=this._maxEntries;if(o<=s)return T(i=H(n.slice(t,e+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=H([])).leaf=!1,i.height=r;var a,l,u,c,h=Math.ceil(o/s),f=h*Math.ceil(Math.sqrt(s));for(K(n,t,e,f,this.compareMinX),a=t;a<=e;a+=f)for(K(n,a,u=Math.min(a+f-1,e),h,this.compareMinY),l=a;l<=u;l+=h)c=Math.min(l+h-1,u),i.children.push(this._build(n,l,c,r-1));return T(i,this.toBBox),i},_chooseSubtree:function(n,t,e,r){for(var i,o,s,a,l,u,c,h,f,p;r.push(t),!t.leaf&&r.length-1!==e;){for(c=h=1/0,i=0,o=t.children.length;i<o;i++)l=q(s=t.children[i]),f=n,p=s,(u=(Math.max(p.maxX,f.maxX)-Math.min(p.minX,f.minX))*(Math.max(p.maxY,f.maxY)-Math.min(p.minY,f.minY))-l)<h?(h=u,c=l<c?l:c,a=s):u===h&&l<c&&(c=l,a=s);t=a||t.children[0]}return t},_insert:function(n,t,e){var r=this.toBBox,i=e?n:r(n),o=[],s=this._chooseSubtree(i,this.data,t,o);for(s.children.push(n),D(s,i);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(n,t){var e=n[t],r=e.children.length,i=this._minEntries;this._chooseSplitAxis(e,i,r);var o=this._chooseSplitIndex(e,i,r),s=H(e.children.splice(o,e.children.length-o));s.height=e.height,s.leaf=e.leaf,T(e,this.toBBox),T(s,this.toBBox),t?n[t-1].children.push(s):this._splitRoot(e,s)},_splitRoot:function(n,t){this.data=H([n,t]),this.data.height=n.height+1,this.data.leaf=!1,T(this.data,this.toBBox)},_chooseSplitIndex:function(n,t,e){var r,i,o,s,a,l,u,c,h,f,p,y,g,x;for(l=u=1/0,r=t;r<=e-t;r++)i=z(n,0,r,this.toBBox),o=z(n,r,e,this.toBBox),h=i,f=o,p=void 0,y=void 0,g=void 0,x=void 0,p=Math.max(h.minX,f.minX),y=Math.max(h.minY,f.minY),g=Math.min(h.maxX,f.maxX),x=Math.min(h.maxY,f.maxY),s=Math.max(0,g-p)*Math.max(0,x-y),a=q(i)+q(o),s<l?(l=s,c=r,u=a<u?a:u):s===l&&a<u&&(u=a,c=r);return c},_chooseSplitAxis:function(n,t,e){var r=n.leaf?this.compareMinX:J,i=n.leaf?this.compareMinY:N;this._allDistMargin(n,t,e,r)<this._allDistMargin(n,t,e,i)&&n.children.sort(r)},_allDistMargin:function(n,t,e,r){n.children.sort(r);var i,o,s=this.toBBox,a=z(n,0,t,s),l=z(n,e-t,e,s),u=G(a)+G(l);for(i=t;i<e-t;i++)o=n.children[i],D(a,n.leaf?s(o):o),u+=G(a);for(i=e-t-1;i>=t;i--)o=n.children[i],D(l,n.leaf?s(o):o),u+=G(l);return u},_adjustParentBBoxes:function(n,t,e){for(var r=e;r>=0;r--)D(t[r],n)},_condense:function(n){for(var t,e=n.length-1;e>=0;e--)0===n[e].children.length?e>0?(t=n[e-1].children).splice(t.indexOf(n[e]),1):this.clear():T(n[e],this.toBBox)},_initFormat:function(n){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(n[0])),this.compareMinY=new Function("a","b",t.join(n[1])),this.toBBox=new Function("a","return {minX: a"+n[0]+", minY: a"+n[1]+", maxX: a"+n[2]+", maxY: a"+n[3]+"};")}};const tn=(t,e)=>{const r=[],i=n.lineSegment(e),o=Q();o.load(i),n.segmentEach(t,t=>{const e=o.search(t),i=X.segment(t,e),s=n.getCoords(i);Array.prototype.push.apply(r,s)});const s=r.filter((n,t)=>0===t||n.some((n,e)=>n!==r[t-1][e]));return n.lineString(s)};var en={boundaries:(t,e)=>{let r=t;return n.flattenEach(e,t=>{const e=n.polygonToLine(t);r=tn(r,e)}),r},line:tn,polygon:(t,e)=>{const r=[],i=Q();return i.load(e),n.featureEach(t,n=>{const t=i.search(n),e=X.triangle(n,t);Array.prototype.push.apply(r,e.features)}),n.featureCollection(r)}};var rn={isInLine:(t,e,r,i,o)=>{if(r=!1!==r,i=!1!==i,o=!1!==o,Y.disjoint(t,e))return!1===o;const s=o?O.flattenSome:O.flattenEvery;return(i?O.coordEvery:O.coordSome)(t,t=>s(e,e=>n.booleanPointOnLine(t,e,{ignoreEndVertices:!1===r})===o))},isInPoint:(t,e,r,i)=>{if(r=!1!==r,i=!1!==i,Y.disjoint(t,e))return!1===i;const o=i?O.flattenSome:O.flattenEvery;return(r?O.coordEvery:O.coordSome)(t,t=>{const r=n.point(t);return o(e,n=>r.geometry.coordinates.every((t,e)=>t===n.geometry.coordinates[e])===i)})},isInPolygon:(t,e,r,i,o)=>{if(r=!1!==r,i=!1!==i,o=!1!==o,Y.disjoint(t,e))return!1===o;const s=o?O.flattenSome:O.flattenEvery;return(i?O.coordEvery:O.coordSome)(t,t=>s(e,e=>n.booleanPointInPolygon(t,e,{ignoreBoundary:!1===r})===o))}};const on=t=>{const e=t.geometry.coordinates.length;return n.point(t.geometry.coordinates[e-1])},sn=(t,e,r)=>(r=!1!==r,O.flattenSome(t,t=>O.flattenSome(e,e=>{const i=n.lineIntersect(t,e);if(!1===r){const r=n.featureCollection([t,e]);if(an(r,i))return!1}return i.features.length>0}))),an=(n,t)=>O.featureEvery(t,t=>O.flattenSome(n,n=>{const e=cn(n),r=on(n);if(rn.isInPoint(t,e)||rn.isInPoint(t,r))return!0})),ln=(t,e,r,i,o,s)=>{r=!1!==r,s=s||0,o=!1!==o;const a=(i=!1!==i)?O.segmentEvery:O.segmentSome;return a(t,t=>{const i=en.line(t,e);return a(i,t=>{const i=n.centroid(t);let a=rn.isInLine(i,e,r);if(!1===a&&s>0){a=n.nearestPointOnLine(e,i).properties.dist<=s}return a===o})})},un=(n,t)=>O.flattenSome(n,n=>{const e=cn(n),r=on(n);return O.flattenSome(t,n=>{const t=cn(n);if(rn.isInPoint(e,t)||rn.isInPoint(r,t))return!0;const i=on(n);return!(!rn.isInPoint(e,i)&&!rn.isInPoint(r,i))||void 0})}),cn=t=>n.point(t.geometry.coordinates[0]);var hn={end:on,isDisjoint:(n,t)=>{return!sn(n,t,!0)&&!ln(n,t,!0,!1,!0)&&!un(n,t)},isIntersecting:sn,isOverlapping:ln,isSimilar:(n,t)=>{const e=(n,t)=>O.flattenEvery(n,n=>O.flattenSome(t,t=>{const e=n.geometry.coordinates,r=t.geometry.coordinates,i=r.length-1;return Y.similar(e,r)||Y.similar(e,r,0,i-1,i,!0)}));return e(n,t)&&e(t,n)},isTouching:un,start:cn};const fn=(n,t)=>{const e=(n,t)=>O.flattenEvery(n,n=>n.geometry.coordinates.every(n=>O.flattenSome(t,t=>t.geometry.coordinates.some(t=>((n,t)=>{const e=n.length-1;for(let r=0;r<e;++r){if(Y.similar(n,t,0,r,1,!0)&&Y.similar(n,t,0,r,e,!0))return!0;if(Y.similar(n,t,0,r,1,!1)&&Y.similar(n,t,0,r,e,!1))return!0}return!1})(n,t)))));return e(n,t)&&e(t,n)},pn=(t,e,r,i,o)=>{if(r=!1!==r,i=!1!==i,o=!1!==o,fn(t,e))return!0===o;const s=I(t),a=I(e),l=en.polygon(s,a);return(i?O.featureEvery:O.featureSome)(l,t=>{const i=n.centroid(t);return rn.isInPolygon(i,e,r)===o})};var yn={isBoundaryIntersecting:(t,e)=>O.flattenSome(t,t=>{const r=n.polygonToLine(t);return O.flattenSome(e,t=>{const e=n.polygonToLine(t);return!1===hn.isDisjoint(r,e)})}),isInPolygon:(n,t)=>!1!==rn.isInPolygon(n,t,!0,!0)&&pn(n,t,!1,!0,!0),relate:pn},gn={clipper:X,helpers:Y,invariant:$,line:hn,meta:O,partition:en,point:rn,polygon:yn,triangulate:I};var xn=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;if(gn.line.isSimilar(n,t))return!0;if(!1===gn.point.isInLine(n,t,!0,!0))return!1;return!!gn.line.isOverlapping(n,t,!1,!0,!0)},dn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.meta.flattenEvery(n,n=>{const e=gn.partition.boundaries(n,t),r=gn.helpers.centroids(e);return!1!==gn.point.isInPolygon(r,t,!0,!0)&&gn.point.isInPolygon(r,t,!1,!1)});var vn=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!1!==gn.point.isInLine(n,t,!0,!0)&&gn.point.isInLine(n,t,!1,!1)},mn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInPoint(n,t,!0),Pn=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!1!==gn.point.isInPolygon(n,t,!0,!0)&&gn.point.isInPolygon(n,t,!1,!1)};var Sn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.polygon.isInPolygon(n,t);const bn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":return xn(n,t);case"LineString-Polygon":return dn(n,t);case"Point-LineString":return vn(n,t);case"Point-Point":return mn(n,t);case"Point-Polygon":return Pn(n,t);case"Polygon-Polygon":return Sn(n,t);default:throw new Error(`${e} within ${r} not supported.`)}},Ln=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":case"LineString-Point":case"Point-Point":case"Polygon-LineString":case"Polygon-Point":case"Polygon-Polygon":return bn(t,n);default:throw new Error(`${e} contains ${r} not supported.`)}};var wn=(n,t)=>xn(n,t),Mn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.meta.flattenEvery(n,n=>{const e=gn.partition.boundaries(n,t),r=gn.helpers.centroids(e);return gn.point.isInPolygon(r,t,!0,!0,!0)});var In=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInLine(n,t,!0,!0,!0),En=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInPoint(n,t,!0),Bn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInPolygon(n,t,!0,!0,!0);var jn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.polygon.isInPolygon(n,t);const Xn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":return wn(n,t);case"LineString-Polygon":return Mn(n,t);case"Point-LineString":return In(n,t);case"Point-Point":return En(n,t);case"Point-Polygon":return Bn(n,t);case"Polygon-Polygon":return jn(n,t);default:throw new Error(`${e} coveredby ${r} not supported.`)}},Yn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":case"LineString-Point":case"Point-Point":case"Polygon-Point":case"Polygon-LineString":case"Polygon-Polygon":return Xn(t,n);default:throw new Error(`${e} covers ${r} not supported.`)}};var $n=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!1!==gn.point.isInLine(n,t,!1,!1,!0)&&gn.point.isInLine(n,t,!0,!1,!1)},_n=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!1!==gn.point.isInPolygon(n,t,!1,!1,!0)&&gn.point.isInPolygon(n,t,!0,!1,!1)};var Zn=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!gn.line.isOverlapping(n,t,!1,!1,!0)&&!!gn.line.isIntersecting(n,t,!1)},On=(n,t)=>$n(t,n),Cn=(t,e)=>{if(gn.helpers.disjoint(t,e))return!1;const r=n.flattenReduce(t,(n,t)=>{if(n.within&&n.outside)return n;const r=gn.partition.boundaries(t,e),i=gn.helpers.centroids(r);return!1===n.within&&(n.within=gn.point.isInPolygon(i,e,!1,!1,!0)),!1===n.outside&&(n.outside=gn.point.isInPolygon(i,e,!0,!1,!1)),n},{within:!1,outside:!1});return r.within&&r.outside};var Rn=(n,t)=>Cn(t,n),An=(n,t)=>_n(t,n);const Fn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":return Zn(n,t);case"LineString-Point":return On(n,t);case"LineString-Polygon":return Cn(n,t);case"Point-LineString":return $n(n,t);case"Point-Polygon":return _n(n,t);case"Polygon-LineString":return Rn(n,t);case"Polygon-Point":return An(n,t);default:throw new Error(`${e} crosses ${r} not supported.`)}};var kn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInLine(n,t,!0,!1),Tn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInPoint(n,t,!1),zn=(n,t)=>!gn.helpers.disjoint(n,t)&&gn.point.isInPolygon(n,t,!0,!1);const Dn=(n,t)=>!gn.helpers.disjoint(n,t)&&!1===gn.line.isDisjoint(n,t);var Jn=Dn,Nn=(n,t)=>kn(t,n),qn=(t,e)=>{if(gn.helpers.disjoint(t,e))return!1;return!!gn.meta.flattenSome(e,e=>{const r=n.polygonToLine(e);return Dn(r,t)})||gn.point.isInPolygon(t,e,!0,!1)};var Gn=(n,t)=>qn(t,n),Un=(n,t)=>zn(t,n),Vn=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!!gn.polygon.isBoundaryIntersecting(n,t)||gn.polygon.relate(n,t,!0,!1,!0)};const Hn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":return Jn(n,t);case"LineString-Point":return Nn(n,t);case"LineString-Polygon":return qn(n,t);case"Point-LineString":return kn(n,t);case"Point-Point":return Tn(n,t);case"Point-Polygon":return zn(n,t);case"Polygon-LineString":return Gn(n,t);case"Polygon-Point":return Un(n,t);case"Polygon-Polygon":return Vn(n,t);default:throw new Error(`${e} intersects ${r} not supported.`)}},Kn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":case"LineString-Point":case"LineString-Polygon":case"Point-LineString":case"Point-Point":case"Point-Polygon":case"Polygon-LineString":case"Polygon-Point":case"Polygon-Polygon":return!1===Hn(n,t);default:throw new Error(`${e} disjoint ${r} not supported.`)}},Qn=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":case"Point-Point":case"Polygon-Polygon":return bn(n,t)&&Ln(n,t);default:throw new Error(`${e} equals ${r} not supported.`)}};var Wn=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;if(gn.line.isSimilar(n,t))return!1;return!1!==gn.line.isOverlapping(n,t,!1,!1,!0,.02)&&!1!==gn.line.isOverlapping(n,t,!0,!1,!1,.02)&&gn.line.isOverlapping(t,n,!0,!1,!1,.02)};var nt=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!1!==gn.point.isInPoint(n,t,!1,!0)&&!1!==gn.point.isInPoint(n,t,!1,!1)&&gn.point.isInPoint(t,n,!1,!1)};var tt=(t,e)=>{if(gn.helpers.disjoint(t,e))return!1;const r=gn.triangulate(t),i=gn.triangulate(e),o=gn.partition.polygon(r,i),s=n.featureReduce(o,(t,r)=>{if(t.within&&t.outside)return t;const i=n.centroid(r);return gn.point.isInPolygon(i,e,!1)?t.within=!0:0==gn.point.isInPolygon(i,e,!0)&&(t.outside=!0),t},{within:!1,outside:!1});if(!1===(s.within&&s.outside))return!1;const a=gn.partition.polygon(i,r);return gn.meta.featureSome(a,e=>{const r=n.centroid(e);return!1===gn.point.isInPolygon(r,t,!0)})};const et=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":return Wn(n,t);case"Point-Point":return nt(n,t);case"Polygon-Polygon":return tt(n,t);default:throw new Error(`${e} overlaps ${r} not supported.`)}};var rt=(n,t)=>!gn.helpers.disjoint(n,t)&&!gn.point.isInLine(n,t,!1,!1,!0)&&gn.point.isInLine(n,t,!0,!1,!0),it=(n,t)=>!gn.helpers.disjoint(n,t)&&!gn.point.isInPolygon(n,t,!1,!1,!0)&&gn.point.isInPolygon(n,t,!0,!1,!0);var ot=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;return!gn.line.isIntersecting(n,t,!1)&&!gn.line.isOverlapping(n,t,!0,!1,!0)&&!!gn.line.isTouching(n,t)},st=(n,t)=>rt(t,n),at=(t,e)=>{if(gn.helpers.disjoint(t,e))return!1;const r=n.flattenReduce(t,(t,r)=>{if(t.within)return t;const i=gn.partition.boundaries(r,e),o=gn.helpers.centroids(i);return gn.point.isInPolygon(o,e,!1,!1,!0)?(t.within=!0,t):(!1===t.exterior&&gn.point.isInPolygon(o,e,!0,!1,!1)&&(t.exterior=!0),t.boundary?t:gn.point.isInPolygon(o,e,!0,!1,!0)?(t.boundary=!0,t):([gn.line.start(r),gn.line.end(r)].some(t=>gn.meta.flattenSome(e,e=>{const r=n.polygonToLine(e);return gn.meta.flattenSome(r,e=>n.booleanPointOnLine(t,e,{ignoreEndVertices:!1}))}))&&(t.boundary=!0),t))},{boundary:!1,exterior:!1,within:!1});return!1===r.within&&r.boundary&&r.exterior};var lt=(n,t)=>at(t,n),ut=(n,t)=>it(t,n),ct=(n,t)=>{if(gn.helpers.disjoint(n,t))return!1;if(gn.point.isInPolygon(n,t,!1,!1))return!1;if(gn.point.isInPolygon(t,n,!1,!1))return!1;return!1!==gn.polygon.isBoundaryIntersecting(n,t)&&gn.polygon.relate(n,t,!0,!0,!1)};const ht=(n,t)=>{const e=gn.invariant.type(n),r=gn.invariant.type(t);switch(`${e}-${r}`){case"LineString-LineString":return ot(n,t);case"LineString-Point":return st(n,t);case"LineString-Polygon":return at(n,t);case"Point-LineString":return rt(n,t);case"Point-Polygon":return it(n,t);case"Polygon-LineString":return lt(n,t);case"Polygon-Point":return ut(n,t);case"Polygon-Polygon":return ct(n,t);default:throw new Error(`${e} touches ${r} not supported.`)}};export{Ln as contains,Xn as coveredby,Yn as covers,Fn as crosses,Kn as disjoint,Qn as equals,Hn as intersects,et as overlaps,ht as touches,bn as within};//# sourceMappingURL=de9im.esm.js.map
